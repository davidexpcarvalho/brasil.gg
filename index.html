<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Índice de Jogadores</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e6e6e6;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #006600; /* Verde da bandeira do Brasil */
        }
        .container {
            margin: 20px auto;
            width: 80%;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 10px 0;
        }
        a {
            text-decoration: none;
            color: #006600;
            font-size: 18px;
        }
        a:hover {
            text-decoration: underline;
            color: #004d00;
        }
    </style>
</head>
<body>
    <h1>Índice de Jogadores</h1>
    <div class="container">
        <ul id="player-list">
            <!-- Links para páginas dos jogadores serão preenchidos dinamicamente -->
        </ul>
    </div>

    <script>
        const playerStatisticsJsonUrl = 'https://davidexpcarvalho.github.io/brasil.gg/player_statistics_rows.json';
        const underperformingPositionsJsonUrl = 'https://davidexpcarvalho.github.io/brasil.gg/underperforming_positions_rows.json';

        async function fetchJson(url) {
            const response = await fetch(url);
            return response.json();
        }

        function createTableHtml(data, headers) {
            if (data.length === 0) {
                return '<p>Nenhum dado disponível.</p>';
            }

            let tableHtml = '<table><thead><tr>';
            headers.forEach(header => {
                tableHtml += `<th>${header}</th>`;
            });
            tableHtml += '</tr></thead><tbody>';

            data.forEach(row => {
                tableHtml += '<tr>';
                headers.forEach(header => {
                    let value = row[header.toLowerCase().replace(/\s/g, '_')];
                    if (header === 'Taxa de Vitórias' || header === 'Desempenho') {
                        value = `${(value * 100).toFixed(2)}%`;
                    }
                    tableHtml += `<td>${value}</td>`;
                });
                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';
            return tableHtml;
        }

        async function createPlayerPages() {
            const playerStatistics = await fetchJson(playerStatisticsJsonUrl);
            const underperformingPositions = await fetchJson(underperformingPositionsJsonUrl);

            const groupedPlayerStats = playerStatistics.reduce((acc, row) => {
                if (!acc[row.player_name]) {
                    acc[row.player_name] = [];
                }
                acc[row.player_name].push(row);
                return acc;
            }, {});

            const groupedUnderperformingPositions = underperformingPositions.reduce((acc, row) => {
                if (!acc[row.player_name]) {
                    acc[row.player_name] = [];
                }
                acc[row.player_name].push(row);
                return acc;
            }, {});

            const allPlayers = new Set([
                ...Object.keys(groupedPlayerStats),
                ...Object.keys(groupedUnderperformingPositions),
            ]);

            const playerList = document.getElementById('player-list');

            allPlayers.forEach(player => {
                const playerFileName = `player_${player.replace(/[^a-zA-Z0-9]/g, '_')}.html`;
                const playerStats = groupedPlayerStats[player] || [];
                const playerUnderperforming = groupedUnderperformingPositions[player] || [];

                // Criar link na página inicial
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${playerFileName}`;
                a.textContent = player;
                li.appendChild(a);
                playerList.appendChild(li);

                // Criar página do jogador
                const playerPage = document.createElement('div');
                playerPage.id = playerFileName;
                playerPage.style.display = 'none';
                playerPage.innerHTML = `
                    <h1>Análise do Jogador ${player}</h1>
                    <div class="container">
                        <h2>Estatísticas do Jogador</h2>
                        ${createTableHtml(playerStats, ['Campeão', 'Jogos Jogados', 'Vitórias', 'Taxa de Vitórias'])}
                    </div>
                    <div class="container">
                        <h2>Posições de Desempenho Inferior</h2>
                        ${createTableHtml(playerUnderperforming, ['Posição', 'Campeão', 'Jogos Jogados', 'Vitórias', 'Desempenho'])}
                    </div>
                `;
                document.body.appendChild(playerPage);

                // Adicionar evento de clique para mostrar a página do jogador
                a.addEventListener('click', function () {
                    document.querySelectorAll('.player-page').forEach(page => page.style.display = 'none');
                    playerPage.style.display = 'block';
                });
            });
        }

        createPlayerPages().then(() => console.log('Páginas dos jogadores geradas com sucesso.'));
    </script>
</body>
</html>
