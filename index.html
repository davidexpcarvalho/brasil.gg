<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2621969615615907"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Índice de Jogadores</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e6e6e6;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #006600; /* Verde */
        }
        h2 {
            color: #ffcc00; /* Amarelo */
        }
        h1, h2, .container, .player-list, #back-button {
            transition: all 0.3s ease-in-out;
        }
        .container {
            margin: 20px auto;
            width: 80%;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            list-style-type: none;
            padding: 0;
        }
        .player-list li {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            padding: 10px;
        }
        .player-list a {
            text-decoration: none;
            color: #006600;
            font-size: 18px;
        }
        .player-list a:hover {
            text-decoration: underline;
            color: #004d00;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        #search-container {
            text-align: center;
            margin: 20px;
        }
        #search-input {
            padding: 10px;
            width: 80%;
            font-size: 16px;
        }
        #back-button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #006600;
            color: #fff;
            text-align: center;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #back-button:hover {
            background-color: #004d00;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Índice de Jogadores</h1>
    <div id="search-container">
        <input type="text" id="search-input" placeholder="Buscar jogador...">
    </div>
    <div class="container">
        <ul id="player-list" class="player-list"></ul>
    </div>
    <div id="pagination-container" class="container hidden">
        <button id="prev-button" onclick="changePage(-1)">Anterior</button>
        <span id="page-info"></span>
        <button id="next-button" onclick="changePage(1)">Próximo</button>
    </div>

    <script>
        const playerStatisticsJsonUrl = 'https://davidexpcarvalho.github.io/brasil.gg/player_statistics_rows.json';
        const underperformingPositionsJsonUrl = 'https://davidexpcarvalho.github.io/brasil.gg/underperforming_positions_rows.json';
        const playersPerPage = 10;
        let currentPage = 1;
        let totalPages = 1;

        async function fetchJson(url) {
            const response = await fetch(url);
            return response.json();
        }

        function formatNumber(value) {
            return Number(value).toFixed(1);
        }

        function createTableHtml(data, headers, fieldMap) {
            if (data.length === 0) {
                return '<p>Nenhum dado disponível.</p>';
            }

            let tableHtml = '<table><thead><tr>';
            headers.forEach(header => {
                tableHtml += `<th>${header}</th>`;
            });
            tableHtml += '</tr></thead><tbody>';

            data.forEach(row => {
                tableHtml += '<tr>';
                headers.forEach(header => {
                    const field = fieldMap[header];
                    let value = row[field] !== undefined ? row[field] : 'N/A';
                    if (typeof value === 'number') {
                        value = formatNumber(value);
                    }
                    if (field === 'win_rate' || field === 'desempenho') {
                        value = value !== 'N/A' ? `${formatNumber(value * 100)}%` : value;
                    }
                    tableHtml += `<td>${value}</td>`;
                });
                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';
            return tableHtml;
        }

        async function createPlayerPages() {
            const playerStatistics = await fetchJson(playerStatisticsJsonUrl);
            const underperformingPositions = await fetchJson(underperformingPositionsJsonUrl);

            const groupedPlayerStats = playerStatistics.reduce((acc, row) => {
                if (!acc[row.player_name]) {
                    acc[row.player_name] = [];
                }
                acc[row.player_name].push(row);
                return acc;
            }, {});

            const groupedUnderperformingPositions = underperformingPositions.reduce((acc, row) => {
                if (!acc[row.player_name]) {
                    acc[row.player_name] = [];
                }
                acc[row.player_name].push(row);
                return acc;
            }, {});

            const allPlayers = new Set([
                ...Object.keys(groupedPlayerStats),
                ...Object.keys(groupedUnderperformingPositions),
            ]);

            const playerList = document.getElementById('player-list');
            playerList.innerHTML = ''; // Clear existing list items

            totalPages = Math.ceil(allPlayers.size / playersPerPage);
            updatePaginationInfo();

            Array.from(allPlayers).forEach(player => {
                const playerFileName = `player_${player.replace(/[^a-zA-Z0-9]/g, '_')}.html`;
                const playerStats = groupedPlayerStats[player] || [];
                const playerUnderperforming = groupedUnderperformingPositions[player] || [];

                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${playerFileName}`;
                a.textContent = player;
                li.appendChild(a);
                playerList.appendChild(li);

                const playerPage = document.createElement('div');
                playerPage.id = playerFileName;
                playerPage.classList.add('player-page');
                playerPage.style.display = 'none';
                playerPage.innerHTML = `
                    <h1>Análise do Jogador ${player}</h1>
                    <button id="back-button" onclick="showPlayerList()">Voltar</button>
                    <div class="container">
                        <h2>Estatísticas do Jogador</h2>
                        ${createTableHtml(playerStats, ['Campeão', 'Jogos Jogados', 'Vitórias', 'Taxa de Vitórias'], {
                            'Campeão': 'champion',
                            'Jogos Jogados': 'games_played',
                            'Vitórias': 'wins',
                            'Taxa de Vitórias': 'win_rate'
                        })}
                    </div>
                    <div class="container">
                        <h2>Posições de Desempenho Inferior</h2>
                        ${createTableHtml(playerUnderperforming, ['Posição', 'Estatística', 'Média do Jogador', 'Média da Posição'], {
                            'Posição': 'position',
                            'Estatística': 'stat',
                            'Média do Jogador': 'player_avg',
                            'Média da Posição': 'position_avg'
                        })}
                    </div>
                `;
                document.body.appendChild(playerPage);

                a.addEventListener('click', function () {
                    document.querySelectorAll('.player-page').forEach(page => page.style.display = 'none');
                    playerPage.style.display = 'block';
                    document.getElementById('player-list').parentElement.style.display = 'none';
                    document.getElementById('search-container').style.display = 'none';
                    document.getElementById('pagination-container').classList.add('hidden');
                });
            });

            showPage(currentPage);
        }

        function showPage(page) {
            const playerList = document.getElementById('player-list');
            const players = playerList.querySelectorAll('li');
            const start = (page - 1) * playersPerPage;
            const end = start + playersPerPage;

            players.forEach((player, index) => {
                if (index >= start && index < end) {
                    player.style.display = 'block';
                } else {
                    player.style.display = 'none';
                }
            });

            updatePaginationInfo();
        }

        function changePage(direction) {
            currentPage += direction;
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            showPage(currentPage);
        }

        function updatePaginationInfo() {
            document.getElementById('page-info').textContent = `Página ${currentPage} de ${totalPages}`;
            document.getElementById('prev-button').disabled = currentPage === 1;
            document.getElementById('next-button').disabled = currentPage === totalPages;
        }

        function showPlayerList() {
            document.querySelectorAll('.player-page').forEach(page => page.style.display = 'none');
            document.getElementById('player-list').parentElement.style.display = 'block';
            document.getElementById('search-container').style.display = 'block';
            document.getElementById('pagination-container').classList.remove('hidden');
        }

        function filterPlayers() {
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const players = document.querySelectorAll('.player-list li');
            players.forEach(player => {
                const playerName = player.textContent.toLowerCase();
                if (playerName.includes(searchInput)) {
                    player.style.display = 'block';
                } else {
                    player.style.display = 'none';
                }
            });
        }

        document.getElementById('search-input').addEventListener('input', filterPlayers);

        createPlayerPages().then(() => console.log('Páginas dos jogadores geradas com sucesso.'));
    </script>
</body>
</html>
