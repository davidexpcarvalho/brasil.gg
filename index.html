<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2621969615615907"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Índice de Jogadores</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e6e6e6;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #006600; /* Verde da bandeira do Brasil */
        }
        h2 {
            color: #ffcc00; /* Amarelo da bandeira do Brasil */
        }
        .container {
            margin: 20px auto;
            width: 80%;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #search-container {
            text-align: center;
            margin: 20px;
        }
        #search-input {
            padding: 10px;
            width: 80%;
            font-size: 16px;
        }
        #dropdown {
            position: absolute;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            width: calc(80% - 22px);
            left: 10%;
            display: none;
            z-index: 1;
        }
        .dropdown-item {
            padding: 10px;
            cursor: pointer;
        }
        .dropdown-item:hover {
            background-color: #f2f2f2;
        }
        .hidden {
            display: none;
        }
        #back-button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #006600;
            color: #fff;
            text-align: center;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #back-button:hover {
            background-color: #004d00;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Índice de Jogadores</h1>
    <div id="search-container">
        <input type="text" id="search-input" placeholder="Buscar jogador...">
        <div id="dropdown"></div>
    </div>

    <script>
        const playerStatisticsJsonUrl = 'https://davidexpcarvalho.github.io/brasil.gg/player_statistics_rows.json';
        const underperformingPositionsJsonUrl = 'https://davidexpcarvalho.github.io/brasil.gg/underperforming_positions_rows.json';

        async function fetchJson(url) {
            const response = await fetch(url);
            return response.json();
        }

        function formatNumber(value) {
            return Number(value).toFixed(1);
        }

        function createTableHtml(data, headers, fieldMap) {
            if (data.length === 0) {
                return '<p>Nenhum dado disponível.</p>';
            }

            let tableHtml = '<table><thead><tr>';
            headers.forEach(header => {
                tableHtml += `<th>${header}</th>`;
            });
            tableHtml += '</tr></thead><tbody>';

            data.forEach(row => {
                tableHtml += '<tr>';
                headers.forEach(header => {
                    const field = fieldMap[header];
                    let value = row[field] !== undefined ? row[field] : 'N/A';
                    if (typeof value === 'number') {
                        value = formatNumber(value);
                    }
                    if (field === 'win_rate' || field === 'desempenho') {
                        value = value !== 'N/A' ? `${formatNumber(value * 100)}%` : value;
                    }
                    tableHtml += `<td>${value}</td>`;
                });
                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';
            return tableHtml;
        }

        async function createPlayerPages() {
            const playerStatistics = await fetchJson(playerStatisticsJsonUrl);
            const underperformingPositions = await fetchJson(underperformingPositionsJsonUrl);

            const groupedPlayerStats = playerStatistics.reduce((acc, row) => {
                if (!acc[row.player_name]) {
                    acc[row.player_name] = [];
                }
                acc[row.player_name].push(row);
                return acc;
            }, {});

            const groupedUnderperformingPositions = underperformingPositions.reduce((acc, row) => {
                if (!acc[row.player_name]) {
                    acc[row.player_name] = [];
                }
                acc[row.player_name].push(row);
                return acc;
            }, {});

            const allPlayers = new Set([
                ...Object.keys(groupedPlayerStats),
                ...Object.keys(groupedUnderperformingPositions),
            ]);

            const dropdown = document.getElementById('dropdown');

            allPlayers.forEach(player => {
                const playerFileName = `player_${player.replace(/[^a-zA-Z0-9]/g, '_')}.html`;
                const playerStats = groupedPlayerStats[player] || [];
                const playerUnderperforming = groupedUnderperformingPositions[player] || [];

                const playerPage = document.createElement('div');
                playerPage.id = playerFileName;
                playerPage.classList.add('player-page');
                playerPage.style.display = 'none';
                playerPage.innerHTML = `
                    <h1>Análise do Jogador ${player}</h1>
                    <button id="back-button" onclick="showSearch()">Voltar</button>
                    <div class="container">
                        <h2>Estatísticas do Jogador</h2>
                        ${createTableHtml(playerStats, ['Campeão', 'Jogos Jogados', 'Vitórias', 'Taxa de Vitórias'], {
                            'Campeão': 'champion',
                            'Jogos Jogados': 'games_played',
                            'Vitórias': 'wins',
                            'Taxa de Vitórias': 'win_rate'
                        })}
                    </div>
                    <div class="container">
                        <h2>Posições de Desempenho Inferior</h2>
                        ${createTableHtml(playerUnderperforming, ['Posição', 'Estatística', 'Média do Jogador', 'Média da Posição'], {
                            'Posição': 'position',
                            'Estatística': 'stat',
                            'Média do Jogador': 'player_avg',
                            'Média da Posição': 'position_avg'
                        })}
                    </div>
                `;
                document.body.appendChild(playerPage);

                const dropdownItem = document.createElement('div');
                dropdownItem.classList.add('dropdown-item');
                dropdownItem.textContent = player;
                dropdownItem.onclick = function() {
                    showPlayerPage(playerFileName);
                };
                dropdown.appendChild(dropdownItem);
            });
        }

        function showPlayerPage(playerFileName) {
            document.querySelectorAll('.player-page').forEach(page => page.style.display = 'none');
            document.getElementById(playerFileName).style.display = 'block';
            document.getElementById('search-container').style.display = 'none';
        }

        function showSearch() {
            document.querySelectorAll('.player-page').forEach(page => page.style.display = 'none');
            document.getElementById('search-container').style.display = 'block';
        }

        function filterPlayers() {
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const dropdown = document.getElementById('dropdown');
            const dropdownItems = dropdown.querySelectorAll('.dropdown-item');
            let hasResults = false;

            dropdownItems.forEach(item => {
                if (item.textContent.toLowerCase().includes(searchInput)) {
                    item.style.display = 'block';
                    hasResults = true;
                } else {
                    item.style.display = 'none';
                }
            });

            dropdown.style.display = hasResults ? 'block' : 'none';
        }

        document.getElementById('search-input').addEventListener('input', filterPlayers);

        createPlayerPages().then(() => console.log('Páginas dos jogadores geradas com sucesso.'));
    </script>
</body>
</html>
